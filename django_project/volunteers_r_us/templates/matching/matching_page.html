{% extends "base.html" %}
{% block content %}
<h1>Volunteer Matching</h1>

<form method="get" class="mb-3">
  <select name="event_id" required>
    <option value="" disabled {% if not selected_event %}selected{% endif %}>-- select event --</option>
    {% for e in events %}
      <option value="{{ e.id }}" {% if selected_event and e.id == selected_event.id %}selected{% endif %}>
        {{ e.title }} — {{ e.date }} — {{ e.location }}
      </option>
    {% endfor %}
  </select>
  <button type="submit">Load Candidates</button>
</form>

{% if selected_event %}
  <table>
    <thead>
      <tr><th>Name</th><th>City/State</th><th>Skills</th><th>Availability</th><th></th></tr>
    </thead>
    <tbody>
      {% for p in candidates %}
        <tr>
          <td>{{ p.full_name|default:p.user.email }}</td>
          <td>{{ p.city }}, {{ p.state }}</td>
          <td>{% for code in p.skills %}{{ code }}{% if not forloop.last %}, {% endif %}{% endfor %}</td>
          <td>{% for d in p.availability %}{{ d }}{% if not forloop.last %}, {% endif %}{% endfor %}</td>
          <td>
            <form method="post" action="{% url 'assign_volunteer' %}">
              {% csrf_token %}
              <input type="hidden" name="event_id" value="{{ selected_event.id }}">
              <input type="hidden" name="user_id" value="{{ p.user.id }}">
              <button type="submit">Assign & Notify</button>
            </form>
          </td>
        </tr>
      {% empty %}
        <tr><td colspan="5">No matching candidates found.</td></tr>
      {% endfor %}
    </tbody>
  </table>
{% endif %}
{% endblock %}
